<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Model Zero</title>
    <link rel="icon" href="./img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/notice.css">
    <script src="./script/jquery-3.6.0.js"></script>
</head>

<body>
    <div class="custom-cursor"></div> <!-- ë§ˆìš°ìŠ¤ë”°ë¼ë‹¤ë‹ˆëŠ” ì› -->
    <a href="#"><button id="chatButton"><img src="./img/chatbot.svg" alt=""><img src="./img/chattxt.svg" alt=""></button> </a>
    <button id="topButton" style="display: none;"><img src="./img/arrow.svg" alt="">Top</button> <!-- íƒ‘ë²„íŠ¼ -->
    <!-- header -->
    <div id="header"></div>
    <section class="notice-container">
        <h2>Notice</h2>
        <h1>ê³µì§€ì‚¬í•­</h1>
        <!-- ê²€ìƒ‰ ë° ì •ë ¬ -->
        <div class="notice-filter">
            <select id="categoryFilter">
                <option value="">ì „ì²´</option>
                <option value="ì œëª©">ì œëª©</option>
                <option value="ë‚´ìš©">ë‚´ìš©</option>
            </select>
            <div class="search">
                <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ìž…ë ¥...">
                <button id="searchButton"><img src="./img/notice-search.svg" alt=""></button>
            </div>
        </div>

        <!-- ðŸ”¹ ê³µì§€ì‚¬í•­ ëª©ë¡ -->
        <div class="notice-list">
            <!--<a href="" class="notice-item" data-category="ê³µì§€">
                <img src="./img/notice_img3.svg" alt="ê³µì§€3">
                <p>No. 10</p>
                <p class="notice-title">ê³µì§€ì œëª© 14</p>
                <p class="notice-txt">ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤. ê³µì§€ë‚´ìš© ì˜ˆì‹œìž…ë‹ˆë‹¤.</p>
                <div class="notice-meta">
                    <p class="author">wal*****</p>
                    <p class="date">25-02-01</p>
                    <p class="view-count"><img src="./img/notice_view.svg" alt="ì¡°íšŒìˆ˜ì•„ì´ì½˜"><span>0</span></p>
               </div>
            </a>
            --->
        </div>

        <!-- íŽ˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="pagination" data-type="notice">
            <button class="prev"><img src="./img/page_prev.svg" alt=""></button>
            <span class="page-numbers"></span>
            <button class="next"><img src="./img/page_next.svg" alt=""></button>
        </div>

    </section>

    <!-- í‘¸í„° -->
    <div id="footer"></div>

</body>
<script src="./script/common.js"></script>
<script>
    let noticeList;
    const $list = $('.notice-list');
    $(document).ready(function () {
        $.ajax({
            url: 'https://api.narrowroad-model.com/model_home_page?func=get-posts&contentType=notice', // ì—¬ê¸°ì— ë„ˆì˜ Lambdaì™€ ì—°ê²°ëœ API Gateway URL
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                noticeList = data;
                renderNoticeList(data);
            },
            error: function (err) {
                console.error("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨", err);
            }
        });

        function renderNoticeList(notices) {

            $list.empty(); // ê¸°ì¡´ ë”ë¯¸ ì‚­ì œ

            notices.forEach(function (notice) {
                const contentText = $(notice.content).text().trim(); // HTML ì•ˆì˜ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
                const thumbnail = notice.images && notice.images.length > 0 ? notice.images[0] : './img/no_img.png';
                const date = new Date(notice.timestamp).toLocaleDateString('ko-KR').slice(2); // ë‚ ì§œ ì˜ˆ: 25. 3. 21
                const maskedUserId = notice.userId.replace(/(?<=.{3})./g, '*'); // ì•„ì´ë”” ë§ˆìŠ¤í‚¹
                const html = `
                <a href="/noticeDetail.html?id=${notice.contentId}" class="notice-item" data-category="ê³µì§€" data-id="${notice.contentId}">
                    <img src="${thumbnail}" alt="ì¸ë„¤ì¼">
                    <p>No. ${notice.contentId}</p>
                    <p class="notice-title">${notice.title}</p>
                    <p class="notice-txt">${contentText.slice(0, 100)}${contentText.length > 100 ? '...' : ''}</p>
                    <div class="notice-meta">
                        <p class="author">${maskedUserId}</p>
                        <p class="date">${date}</p>
                        <p class="view-count"><img src="./img/notice_view.svg" alt="ì¡°íšŒìˆ˜ì•„ì´ì½˜"><span>${notice.view}</span></p>
                   </div>
                </a>
            `;
                $list.append(html);
            });
        }

        $list.on('click', '.notice-item', function (e) {
            const id = $(this).data('id');
            const selectedPost = noticeList.find(n => n.contentId === id);
            sessionStorage.setItem('selectedPost', JSON.stringify(selectedPost));
        });
    });
</script>
</html>